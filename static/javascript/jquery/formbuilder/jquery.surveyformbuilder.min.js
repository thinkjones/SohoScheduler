jQuery(function(d){var b={id:0,save_url:false,load_url:false,load_data:false,formType:"form",form_design_data:false,form_data:false,form_post_url:false,toolbox_control:"ul",runtime_form_placeholder:"",menu_control_placeholder:"",save_handler:"",easysort_handler:"",testdrive_handler:"",setupscreen_mode:"design",controls:{text:{DisplayName:"Single Line Text",ControlType:"text",HtmlControl:"input",HtmlControlType:"text"},textarea:{DisplayName:"Paragraph Text",ControlType:"textarea",HtmlControl:"textarea",HtmlControlType:""},narrative:{DisplayName:"Help Text",ControlType:"narrative",HtmlControl:"div",HtmlControlType:""},radio:{DisplayName:"Multiple Choice",ControlType:"radio",HtmlControl:"div",HtmlControlType:""},checkbox:{DisplayName:"Checkboxes",ControlType:"checkbox",HtmlControl:"div",HtmlControlType:""},select:{DisplayName:"Dropdown List",ControlType:"select",HtmlControl:"div",HtmlControlType:""},rank:{DisplayName:"Rating",ControlType:"rank",HtmlControl:"input",HtmlControlType:""},date:{DisplayName:"Date",ControlType:"date",HtmlControl:"input",HtmlControlType:"date"},time:{DisplayName:"Time",ControlType:"time",HtmlControl:"input",HtmlControlType:"time"}}};var j={survey:{type:"survey",TitleLabel:"Question Name:",HelpLabel:"Question",OptionLabel:"Multiple Choices",TitleWatermark:"-enter your question name here-",HelpWatermark:"-enter your question here-"},form:{type:"form",TitleLabel:"Label",HelpLabel:"Help Text",OptionLabel:"Multiple Choices",TitleWatermark:"-enter the field name-",HelpWatermark:"-enter some help text to assist your users when entering this form field-"}};var e={P:["pa","pid"],D:["se","pid"],DL:["se","tb","lb","pid"],DH:["se","tb","ht","pid"],DR:["se","ch","rq","pid"],DRD:["se","dv","rq","pid"],DCTL:["se","dvul","ct","pid"],DOP:["se","li","ls","pid","cid"],DOPL:["se","tb","ls","pid","cid"],DC:["se","bt","ct","pid"],DAO:["se","bt","ao","pid"],DRO:["se","bt","ao","pid","cid"],DANC:["se","ln","an","pid"],R:["rt","pid"],RL:["rt","tb","lb","pid"],RH:["rt","tb","ht","pid"],RR:["rt","ch","rq","pid"],RRD:["rt","dv","rq","pid"],RHID:["rt","tb","hd","pid"],RW:["rt","dv","wr","pid"],RCTL:["rt","dvul","ct","pid"],ROP:["rt","li","ls","pid","cid"],ROPI:["rt","tb","ls","pid","cid"],ROPL:["rt","lb","ls","pid","cid"]};var k=0;var h=0;var l='<hr class="clearboth" />';var a=null;var f=null;var c=null;d.fn.surveyFormBuilder=function(m){d.fn.surveyFormBuilderOptions(m);return this.each(function(){var n=g(d(this),m);n.initialize()})};d.fn.surveyFormBuilderOptions=function(m){a=d.extend(b,m);f=j[a.formType];c=a.setupscreen_mode};function g(n,m){this.ul_obj=n;this.opts=m;this.initialize=function(){if(a.setupscreen_mode=="runtime"){initializeRuntime()}else{initializeDesigner()}};this.initializeRuntime=function(){d(n).html("");a.form_design_data=a.form_design_data.formdesign;a.form_data=a.form_data.formdata;for(control in a.form_design_data){var o=a.form_design_data[control];if(o.id>k){k=o.id}var s=o.id;var t=create_FB_Div().attr("id",GetObjectID("R",s)).addClass("fb-runtime");var r=d("<li></li>").addClass("fb-item").append(t);d(n).append(d(r));renderRuntimeControlIntoPlaceholder(s,o.type,false,o);if(o.choices){var p=0;for(choice in o.choices){var q=o.choices[choice];createRuntimeOption(s,p,o.type,q);p++}}k++}loadFormWithData();d(n).show()};this.initializeDesigner=function(){d(n).html("");d(n).sortable({handle:".movebutton",axis:"y",placeholder:"ui-state-highlight",forcePlaceholderSize:true,start:function(){d(".toggle-fb-holder").html("show options").addClass("toggle-fb-holder-closed")},update:function(){updateSort()}});d(n).after('<div id="DebugWindow"></div>');d(a.save_handler).click(function(){saveDesignForm(n)});d(a.easysort_handler).click(function(){SetupScreen_EasySort(n)});d(a.testdrive_handler).click(function(){SetupScreen_TestDrive(n)});d(a.design_handler).click(function(){SetupScreen("design")});var r=createToolboxControl();if(a.menu_control_placeholder){d(a.menu_control_placeholder).append(d(r)).append(l)}else{var q=r.cloneNode(true);var s=r.cloneNode(true);d(q).attr("name","field_control_top");d(s).attr("name","field_control_bot");var p=document.createElement("div");d(p).append(q);var o=document.createElement("div");d(o).append(s);d(this).before(d(p).html()+l);d(this).after(d(o).html()+l)}d(".field_control>li").click(function_add_control_to_form);if(a.form_design_data){a.form_design_data=a.form_design_data.formdesign;SetupFormFromDesignData(a.form_design_data)}};this.SetupFormFromDesignData=function(p){for(control in p){var o=p[control];if(o.id>k){k=o.id}AddFormElement(o.id,o.type,o)}k++;d(".fb-holder").slideUp()};this.saveDesignForm=function(){if(a.save_url){var r=getfieldsJSON();var q={formdesign:r};postDict={action:"saveFormData",form_id:a.id,form_design:d.toJSON(q)};var p=d.toJSON(postDict);var o=function(s,t){alert("Design Saved");a.postsavefunction()};d.post(a.save_url,postDict,o,"json")}return false};d("#lnkSaveddlAppointmentDateField").click(function(){var p="{%url designer.views.updatedsettings entity_id%}";var o={action:"defaultFieldUpdate",form_type:1,default_field:d("#ddlAppointmentDateField").val()};d("#lnkSaveddlAppointmentDateField").toggle();d.post(p,o,callbackFunc,"json");return false});this.jsonLoadForm=function(){var p=a.load_url;var q=a.load_data;var o=function(r,s){a.form_design_data=r;SetupFormFromDesignData(r)};d.post(p,q,o,"json")};this.createToolboxControl=function(){var s=document.createElement(a.toolbox_control);d(s).attr("id","createEL").attr("class","field_control");var p="";if(a.toolbox_control=="select"){p="option"}if(a.toolbox_control=="ul"){p="li"}for(var r in a.controls){var o=document.createElement(p);var q=a.controls[r]["ControlType"];d(o).attr("ControlType",q).attr("class",q).text(a.controls[r]["DisplayName"]);d(s).append(o)}return s};this.function_add_control_to_form=function(){d(".fb-holder").slideUp();d(".toggle-fb-holder").html("show options").addClass("toggle-fb-holder-closed");uid=getFBID();changesMade=true;ctrlType=d(this).attr("ControlType");ctrlAttrs=getDefaultFieldAttributesJSON(uid,ctrlType);AddFormElement(uid,ctrlType,ctrlAttrs);d(this).val("");var o=GetJQObjectID("P",uid);d().scrollTo(d(o),800);return false};this.updateSort=function(p){var o="";if(p!=true){changesMade=true}jQuery.each(d("#fb-eval ul li"),function(){if(d(this).attr("id")!=""){if(o.length>0){o+="&"}o+=d(this).attr("id")}});d("#fb-eval-sort").val(o)};getFBID=function(){h=k;return k++};AddFormElement=function(s,q,p){var r="";switch(q){case"text":r=create_FB_Text(s,"text",p);break;case"narrative":r=create_FB_narrative(s,"narrative",p);break;case"textarea":r=create_FB_Text(s,"textarea",p);break;case"rank":r=create_FB_Rank(s,"rank",p);break;case"select":r=create_FB_Select(s,"select",p);break;case"checkbox":r=create_FB_Checkbox(s,"checkbox",p);break;case"radio":r=create_FB_Radio(s,"radio",p);break;case"date":r=create_FB_Date(s,"date",p);break;case"time":r=create_FB_Time(s,"time",p);break;default:return false}d(n).append(r);renderRuntimeControlIntoPlaceholder(s,q,true);if(p.choices){for(choice in p.choices){var o=AddOptionToDesignControlAndRuntimeControl(s,q,p.choices[choice]);update_runtime_input_from_design(s,o)}}d(".fb-header").hide();return true};update_runtime_input_from_design=function(s,r){var p=d(GetJQObjectID("DOPL",s,r));var o=d("#"+p.attr("controlToUpdate"));if(o){var q=p.val();o.text(q)}return true};renderRuntime=function(){if(a.runtime_form_placeholder.length<1){return false}var u=getfieldsJSON();var p="";d(a.runtime_form_placeholder).empty();for(var t in u){p=p+t+"-";control_attrs=u[t];for(var r in control_attrs){p=p+"["+r+":"+control_attrs[r]+"] ";p=p+"<br />"}}var y=d("dl#runtimeform");if(y.length==0){var x=document.createElement("dl");d(x).attr("id","runtimeform").attr("class","ctrl-runtime");y=d(x)}for(var t in u){control_attrs=u[t];var v=document.createElement("dt");var s=document.createElement("dd");var o=document.createElement("label");var w=document.createElement("div");var q=document.createElement("input");d(v).text(control_attrs.label);d(o).attr("class","help").text(control_attrs.help);d(q).attr("id","rt"+control_attrs.parentcontrol).attr("class","element text medium").attr("type","text").attr("value","");d(w).append(q);d(s).append(o).append(w);d(y).append(v).append(s)}d(a.runtime_form_placeholder).append(y)};create_FB_Div=function(){var o=d("<div></div>");return o};create_FB_Table=function(){return d('<table class="fb-table"></table>')};create_FB_TD=function(){return d("<td></td>")};create_FB_TR=function(){return d("<tr></tr>")};create_FB_UL=function(){return d("<ul></ul>")};create_FB_LI=function(){return d("<li></li>")};create_FB_A=function(){return d("<a></a>")};create_FB_Label=function(){return d("<label></label>")};create_FB_Option=function(r,q,p){var o=d("<option></option>");o.attr("text",r);o.val(q);if(typeof(p)!="undefined"){o.attr("selected",true)}return o};create_FB_Select=function(q,r,p){var o=d("<select></select>");o.attr("name",q);o.attr("id",r);if(typeof(p)=="object"){jQuery.each(p,function(){o.append(createOption(this.text,this.value,this.selected))})}return o};create_FB_Input=function(q,p,o){return d('<input type="'+p+'" />').attr({name:q,id:q}).val(o)};create_FB_TextArea=function(q,p,o){return d('<textarea type="'+p+'" ></textarea').attr({name:q,id:q}).val(o)};create_FB_Selectbox=function(o){return d("<select></select>").attr({name:o,id:o})};create_FB_DeleteLink=function(p){var o=d('<a class="smallerbutton deletebutton right" title="Are you sure you want to delete this form section?" href="#" class="del-button delete-confirm">Delete</a>').click(function(){var q=d(this).attr("ctrlid");if(confirm(d(this).attr("title"))){d(GetJQObjectID("P",q)).animate({opacity:"hide",height:"hide",marginBottom:"0px"},"slow",function(){d(this).remove()})}return false});o.attr("ctrlid",p);o.attr("id",GetObjectID("DC",p));return o};create_FB_ToggleLink=function(p){var o=d('<a href="#" class="toggle-fb-holder toggle-fb-holder-opened" id="fb_toggle_'+p+'">hide options</a>&nbsp;&nbsp;');o.click(function(){var q=d(this).attr("id").replace(/fb_toggle_/,"");if(d(this).html()=="hide options"){d(this).html("show options").addClass("toggle-fb-holder-closed")}else{d(this).html("hide options").addClass("toggle-fb-holder-opened")}d("#fb_holder_"+q).slideToggle();return false});return o};createComplexControls=function(s,r){if(r.type!="time"&&r.type!="date"){return}if(r.type=="time"){var p=GetJQObjectID("RW",r.id);var q=document.createElement("a");var o=d(p).attr("id")+"chooser";d(q).attr("class","choose-time").text("&nbsp;").attr("href","#").attr("id",o);d(q).click(function(){d(p).focus();return false});d(p).parent().append(q);d(p).timepickr({convention:12})}if(r.type=="date"){var p=GetJQObjectID("RW",r.id);var q=document.createElement("a");var o=d(p).attr("id")+"chooser";d(q).attr("class","choose-date").text("&nbsp;").attr("href","#").attr("id",o);d(q).click(function(){d(p).focus();return false});d(p).parent().append(q)}};renderRuntimeControlIntoPlaceholder=function(p,o,r,D){containerObj="dl";var v=document.createElement(containerObj);d(v).attr("id","runtimecontrol_"+p).attr("class","ctrl-runtime");if(r){D=getfieldAttributesJSON(p)}var E=document.createElement("span");d(E).attr("id",GetObjectID("RL",p)).text(D.label);var q=document.createElement("span");d(q).addClass("required").attr("id",GetObjectID("RR",p)).text("* required");if(D.required==false){d(q).hide()}var A=document.createElement("label");d(A).attr("class","help").text(D.help).attr("id",GetObjectID("RH",p));var C=document.createElement("div");var u=create_FB_RuntimeControl(p,o,D);d(u).attr("name",D.label);d(C).append(u);var t=document.createElement("hr");d(t).attr("class","clearboth");var z=document.createElement("dt");d(z).append(E).append(q);var s=document.createElement("dd");d(s).append(A).append(C);d(v).append(z).append(s).append(t);var x=GetJQObjectID("R",p);d(x).append(v);createComplexControls(p,D);if(r){var w=d(GetJQObjectID("DL",p));d(w).keyup(onlistenforkeyup);var B=d(GetJQObjectID("DH",p));d(B).keyup(onlistenforkeyup);var y=d(GetJQObjectID("DR",p));d(y).change(requiredselected)}};loadFormWithData=function(){for(dataKey in a.form_data){dataItem=a.form_data[dataKey];var p=d("[name="+dataKey+"]");if(d(p).length>0){var q=d(d(p)[0]);var o=d(p)[0].tagName;if(o=="INPUT"||o=="text"){d(q).val(dataItem)}if(o=="TEXTAREA"){d(q).text(dataItem)}}}};create_FB_RuntimeControl=function(t,s,r){var q=a.controls[s]["HtmlControl"];var p=a.controls[s]["HtmlControlType"];var o=document.createElement(q);d(o).attr("id",GetObjectID("RW",r.id));if(s=="text"){d(o).attr("class","element text medium").attr("type",p).attr("value","")}if(s=="textarea"){d(o).attr("class","element text medium")}if(s=="checkbox"){d(o).attr("class","element text medium").attr("value","")}if(s=="date"){d(o).datepicker({changeMonth:true,changeYear:true}).addClass("short").addClass("floatleft")}if(s=="time"){d(o).addClass("short").addClass("floatleft")}return d(o)};create_FB_Container=function(u,t){var o=GetObjectID("P",u);var q=create_FB_A();var p=GetJQObjectID("DANC",u);q.attr("id",p);var s=create_FB_Div().attr("id",GetObjectID("R",u)).addClass("fb-runtime");var r=d("<li></li>").attr({id:o}).attr("controltype",t).attr("uid",u).addClass("fb-item").addClass("fb-round-corners").addClass("fb-item-border").append(q).append(create_FB_Header(u,t)).append(s);return r};create_FB_Header=function(r,q){var p="";var o=create_FB_Div().attr("id","fb_header_"+r).addClass("fb-header").append('<strong id="fb_title_'+r+'" class"fb-title">&nbsp;[Control Label]&nbsp;</strong>').append('<strong id="fb_title_control_type_'+r+'" class"fb-title">&nbsp;('+q+")&nbsp;</strong>").append(p).append('<hr class="clearboth"');return o};create_FB_Legend=function(q,p){var o=create_FB_Div().attr("id","fb_legend_"+q).addClass("fb-legend").append('<a class="movebutton smallerbutton right">&nbsp;move</a>').append(create_FB_DeleteLink(q)).append(create_FB_ToggleLink(q)).append('<hr class="clearboth"');return o};create_FB_ElementsDiv=function(w,u,r){var G="";var t="";var o=false;var E=create_FB_Div().attr("id","fb_elements_"+w).addClass("fb-elements");var q;var y=create_FB_Input(GetObjectID("DL",w),"text","").addClass("fb-text-input-long fb-text-input");if(typeof(u)!="undefined"&&u=="textarea"){q=create_FB_TextArea(GetObjectID("DH",w),"text","").addClass("fb-text-input-long fb-text-input")}else{q=create_FB_Input(GetObjectID("DH",w),"text","").addClass("fb-text-input-long fb-text-input")}if(f.type=="form"){y.addClass("fb-text-input")}else{q.addClass("fb-text-input")}var H=create_FB_Input(GetObjectID("DR",w),"checkbox",1).addClass("required").addClass("checkbox");var D=create_FB_Label().addClass("fb-required-label").attr("for",GetObjectID("DR",w)).text("Required");var z=create_FB_Div().attr("id",GetObjectID("DRD",w)).addClass("fb-required").append(D);d(y).attr("controlToUpdate",GetObjectID("RL",w));d(q).attr("controlToUpdate",GetObjectID("RH",w));d(H).attr("controlToUpdate",GetObjectID("RR",w));if(typeof(r)=="object"){if(typeof(r.label)!="undefined"){y.val(r.label)}if(typeof(r.help)!="undefined"){q.val(r.help)}if(typeof(r.required)!="undefined"){if(r.required=="true"||r.required==true){H.attr("checked",true)}}}fbCtrlNameLabel=create_FB_Div().css("display","block").append('<label class="fb-label">'+f.TitleLabel+"</label>");fbHelpTextLabel=create_FB_Div().css("display","block").append('<label class="fb-label">'+f.HelpLabel+"</label>");var A=document.createElement("dl");d(A).attr("id","control_attributes_"+w).attr("class","ctrl-attrs");var C=d(A);if(u!="narrative"){var F=create_FB_Attribute_Row(z,H)}var B=create_FB_Attribute_Row(fbCtrlNameLabel,y);var v=create_FB_Attribute_Row(fbHelpTextLabel,q);d(C).append(F).append(B).append(v);if(u=="radio"||u=="select"||u=="checkbox"){var p=create_FB_Div().css("display","block").append('<label class="fb-label">'+f.OptionLabel+"</label>");var x=create_FB_MagicList(w,u,r);var s=create_FB_Attribute_Row(p,x);d(C).append(s)}d(C).append('<hr class="clearboth" />');E.append(C);return E};onlistenforkeyup=function(p){var q=d(this).attr("id");var r=d(this).attr("controltoupdate");var o=p.keyCode;return listenforkeyup(q,r,o)};listenforkeyup=function(t,u,r){var q=t;var p=u;if(p.length>0){var s=d("#"+q).val();var o="#"+p;d(o).text(s)}return true};onlistenforkeydown=function(q){var r=GetParentIDForControl(this);var p=d(this).attr("optionid");var o=q.keyCode;return listenforkeydown(r,p,o)};listenforkeydown=function(z,p,v){if(!p){return true}var y=parseInt(p);var r=GetObjectID("DOPL",z,y);var t=GetJQObjectID("DAO",z);var q=GetJQObjectID("DRO",z,y);var x=GetJQObjectID("DCTL",z);var s=x+" input";var w=d(s).length;var u=0;var o=-1;for(u=0;u<w;u++){if(d(s)[u].id==r){o=u}}if(v==d.keyCode.ENTER){d(t).click()}if(v==d.keyCode.BACKSPACE&&d(this).val()==""){d(q).click();var A=o-1;if(A>=0){d(d(s)[A]).focus()}}if(v==d.keyCode.UP){var A=o-1;if(A<w){d(d(s)[A]).focus()}if(d(this).val().length==0){d(q).click()}}if(v==d.keyCode.DOWN){if(o==w-1){if(d(this).val().length>0){d(t).click()}}else{var A=o+1;if(A<w){d(d(s)[A]).focus()}}}return true};GetParentIDForControl=function(p){var q="";bolFin=false;iCount=0;var o=p;while(bolFin==false){iCount++;if(iCount>20){bolFin=true}if(d(o).attr("id")=="form-builder"){bolFin=true}if(bolFin==false){if(d(o).attr("uid")==""||d(o).attr("uid")==undefined){o=d(o).parent()}else{q=d(o).attr("uid");bolFin=true}}}return q};requiredselected=function(){var o=d(this).attr("controlToUpdate");var p=(d(this).attr("checked")?d(this).val():0);if(o.length>0){strControlToUpdate="#"+o;if(p==1){d(strControlToUpdate).show()}else{d(strControlToUpdate).hide()}}};create_FB_Attribute_Row=function(q,o){var s=document.createElement("div");var r=document.createElement("dt");var p=document.createElement("dd");d(r).append(q);d(p).append(o);d(s).append(r).append(p);return d(s).children()};create_FB_Text_Base=function(p,s,o){if(f=="form"){if(s=="text"){var t="Single Line Response"}else{var t="Multiple Line Response"}}else{if(s=="text"){var t="Text"}else{var t="TextArea"}}if(s=="date"){var t="Date"}var w=create_FB_Container(p,s);var r="";var v=create_FB_Legend(p,t);var u=create_FB_Div().attr("id","fb_holder_"+p).addClass("fb-holder");var q=create_FB_ElementsDiv(p,s,o);w.append(r).append(v).append(u.append(q));return w};create_FB_Text=function(r,p,o){var q=create_FB_Text_Base(r,p,o);return q};create_FB_Date=function(r,q,p){var o=create_FB_Text_Base(r,q,p);return o};create_FB_Time=function(r,p,o){var q=create_FB_Text_Base(r,p,o);return q};create_FB_narrative=function(p,s,o){if(s=="text"){var t="Single Line Response"}else{var t="Multiple Line Response"}var r="";var w=create_FB_Container(p,s);var v=create_FB_Legend(p,"Help Section");var u=create_FB_Div().attr("id","fb_holder_"+p).addClass("fb-holder");var q=create_FB_ElementsDiv(p,s,o);w.append(r).append(v).append(u.append(q));return w};create_FB_Rank=function(q,x,o){var u="";var D=create_FB_Container(q,x);var B=create_FB_Legend(q,"Rank");var z=create_FB_Div().attr("id","fb_holder_"+q).addClass("fb-holder");var t=create_FB_ElementsDiv(q,x,o);var v=create_FB_Div().attr("id","fb_rank_"+q).addClass("fb-rank");var p=create_FB_Div().attr("id","fb_rank_opts_"+q).addClass("fb-rank-opts");var s=create_FB_Selectbox("rank_from_"+q);var w=create_FB_Selectbox("rank_to_"+q);var y=create_FB_Div().attr("id","fb_rank_label_"+q).addClass("fb-rank-label");var A="";var E="";s.append(create_FB_Option("NA",-1));for(i=0;i<=2;i++){s.append(create_FB_Option(i,i))}for(i=3;i<=10;i++){w.append(create_FB_Option(i,i))}if(typeof(o)=="object"){if(typeof(o.RANKFROM)!="undefined"){s.val(o.RANKFROM)}if(typeof(o.RANKTO)!="undefined"){w.val(o.RANKTO)}if(typeof(o.RANKLABELTO)!="undefined"){A=o.RANKLABELTO}if(typeof(o.RANKLABELFROM)!="undefined"){E=o.RANKLABELFROM}}var r=create_FB_Table();E=create_FB_TD().append(create_FB_Input("rank_label_from_"+q,"text",E));E=create_FB_TR().append("<td>From</td").append(E);A=create_FB_TD().append(create_FB_Input("rank_label_to_"+q,"text",A));A=create_FB_TR().append("<td>To</td").append(A);r.append(E).append(A);var C=p.append("<span>Rank</span>").append("&nbsp;From&nbsp;").append(s).append("&nbsp;To&nbsp;").append(w);v.append(C);v.append(y.append("<p>Labels Optional</p>").append(r));D.append(u).append(B).append(z.append(t.append(v)));return D};create_FB_Select=function(p,s,o){if(s=="text"){var t="Single Line Response"}else{var t="Choose from a list"}var r="";var w=create_FB_Container(p,s);var v=create_FB_Legend(p,t);var u=create_FB_Div().attr("id","fb_holder_"+p).addClass("fb-holder");var q=create_FB_ElementsDiv(p,s,o);w.append(r).append(v).append(u.append(q));return w};create_FB_Radio=function(p,s,o){if(s=="text"){var t="Single Line Response"}else{var t="Multiple choice"}var r="";var w=create_FB_Container(p,s);var v=create_FB_Legend(p,t);var u=create_FB_Div().attr("id","fb_holder_"+p).addClass("fb-holder");var q=create_FB_ElementsDiv(p,s,o);w.append(r).append(v).append(u.append(q));return w};create_FB_Checkbox=function(p,s,o){if(s=="text"){var t="Single Line Response"}else{var t="Checkbox"}var r="";var w=create_FB_Container(p,s);var v=create_FB_Legend(p,t);var u=create_FB_Div().attr("id","fb_holder_"+p).addClass("fb-holder");var q=create_FB_ElementsDiv(p,s,o);w.append(r).append(v).append(u.append(q));return w};create_FB_MagicList=function(u,q,p){var o=create_FB_Div().addClass("fb-options-holder");var t=create_FB_UL().addClass("fb-options-holder").attr("id",GetObjectID("DCTL",u));var r=create_FB_Div().attr("id","fb_add_option_row_"+u).addClass("add-option-holder");var s=create_FB_MagicList_AddOptionButton(u);o.append(t);r.append(s);o.append(r);return o};create_FB_MagicList_AddOptionButton=function(q){var p=create_FB_A();var o=GetObjectID("DAO",q);p.attr("href","#").attr("parentID",q).attr("id",o).text("Add Option").attr("class","smallerbutton addbutton");p.click(OnAddOptionClick);return p};OnAddOptionClick=function(){var p=d(this).attr("parentID");var o=d(GetJQObjectID("P",p)).attr("controltype");AddOptionToDesignControlAndRuntimeControl(p,o)};AddOptionToDesignControlAndRuntimeControl=function(z,x,s){var y=getFBID();var w=GetObjectID("DCTL",z);var r=GetObjectID("DOP",z,y);var u=create_FB_LI().attr("id",r);var o=GetObjectID("DOPL",z,y);var t=create_FB_Input(o,"text","").addClass("fb-text-option").attr("optionid",y);if(s){d(t).val(s.text)}if(x=="select"){var v=GetObjectID("ROP",z,y);d(t).attr("controltoupdate",v).keyup(onlistenforkeyup)}else{var v=GetObjectID("ROPL",z,y);d(t).attr("controltoupdate",v).keyup(onlistenforkeyup).keydown(onlistenforkeydown)}d(t).attr("pk","0");var q="#"+GetObjectID("DCTL",y)+" input";d(t).attr("pos",d(q).length);var p=GetObjectID("DRO",z,y);var A=d('<a href="#">remove</a>').attr("id",p).attr("class","smallerbutton deletebutton").attr("optionid",y).attr("parentid",z).click(RemoveOptionLinkClick);d(u).append(t).append(A);d("#"+w).append(u);d(t).focus();createRuntimeOption(z,y,x);return y};RemoveOptionLinkClick=function(){var o=d(this).attr("optionid");var q=d(this).attr("parentid");var p=GetJQObjectID("ROP",q,o);d(this).parent().remove();d(p).remove();return false};createRuntimeOption=function(s,r,o,p){var q=GetObjectID("P",s);if(o=="radio"||o=="checkbox"){createRuntimeOptionList(s,r,o,p)}if(o=="select"){createRuntimeOptionSelect(s,r,o,p)}};createRuntimeOptionList=function(D,y,B,C){var q=GetObjectID("R",D);var t=GetObjectID("RW",D);var x=d("#"+t).attr("name");var o=GetObjectID("RHID",D);var z=GetObjectID("RCTL",D);if(d("#"+z).length==0){rtUL=create_FB_UL().addClass("fb-options-holder").attr("id",z);d("#"+t).append(rtUL);var A=create_FB_Input(D,"hidden","");d(A).attr("id",o).attr("name",x);d("#"+t).append(A)}var s=GetObjectID("ROP",D,y);var w=create_FB_LI().attr("id",s);var r=GetObjectID("ROPI",D,y);var u=create_FB_Input(r,B,"").addClass("fb-text-option").attr("name","rtgroup_"+D);d(u).click(function(){var E=d(this).val();d("#"+o).val(E)});if(C){d(u).val(C.text)}var v=GetObjectID("ROPL",D,y);var p=document.createElement("label");d(p).attr("id",v).attr("for",r);if(C){d(p).text(C.text)}w.append(u).append(p);d("#"+z).append(w)};createRuntimeOptionSelect=function(w,r,u){var o=GetObjectID("R",w);var q=GetObjectID("RW",w);var s=GetObjectID("RCTL",w);if(d("#"+s).length==0){var p=document.createElement("select");d(p).attr("id",s);d("#"+q).append(p)}var v=GetObjectID("ROP",w,r);var t=create_FB_Option("","",false).addClass("fb-radio-option").attr("id",v);d("#"+s).append(t)};getDefaultFieldAttributesJSON=function(o,q){strparentcontrol="fb_item_"+o;var p={id:o,parentcontrol:strparentcontrol,type:q,required:false,label:"New "+a.controls[q].DisplayName,help:"<help text>",defaultoption:"",choices:{}};return p};getfieldsJSON=function(){var o={};var r="#"+d(n).attr("id")+">li";var u=d(r).length;for(var p=0;p<u;p++){var t=d(n).children()[p];var q=d(t).attr("uid");var s=getfieldAttributesJSON(q,p);o[p]=s}return o};getfieldAttributesJSON=function(B,F){v=B;strli=GetJQObjectID("P",v);var E=d(strli)[0];var v=d(E).attr("uid");var u=d(E).attr("id");var s=d(E).attr("controltype");var o=(d(GetJQObjectID("DR",v)).attr("checked")?d(GetJQObjectID("DR",v)).val():0);var y=d(GetJQObjectID("DL",v)).val();var r=d(GetJQObjectID("DH",v)).val();var q=GetObjectID("DCTL",v);var t="#"+q+" input";var w={};for(var z=0;z<d(t).length;z++){var x=d(t)[z];var C={id:d(x).attr("pk"),text:d(x).val(),pos:d(x).attr("pos")};w[z]=C}var A="";strDefaultOptionsSelector="#fb_holder_"+v+" div[id^=fb_option_row_] input[id^=default_option]:checked";var D=d(strDefaultOptionsSelector);if(D.length>0){A=d(d(strDefaultOptionsSelector)[0]).attr("id")}var p={id:v,pos:F,parentcontrol:u,type:s,required:o,label:y,help:r,defaultoption:A,choices:w};return p};GetObjectID=function(u,t,p){var q=e[u];var s="";for(i=0;i<q.length;i++){var r=q[i];switch(r){case"pid":s=s+t+"_";break;case"cid":s=s+p+"_";break;default:s=s+r+"_"}}if(s.length>0){var o=String(s).length;s=String(s).substring(0,o-1)}return s};GetJQObjectID=function(q,p,o){return"#"+GetObjectID(q,p,o)};SetupScreen=function(q){var p=d(n).attr("id");var w=d("#"+p);var v=p+"_easysort_wrapper";var u=d("#"+v);var s=p+"_testdrive_wrapper";var x=d("#"+s);var r=null;var o=null;var t=false;w.fadeOut(300);u.fadeOut(300);x.fadeOut(300);d(a.menu_control_placeholder).hide();if(c=="design"){r=w}if(c=="easysort"){r=u}if(c=="testdrive"){r=x}if(q=="design"){o=w;t=true}if(q=="easysort"){o=u}if(q=="testdrive"){o=x}c=q;d(r).fadeOut(300,function(){d(o).fadeIn(300);if(t){d(a.menu_control_placeholder).show()}})};SetupScreen_EasySort=function(){var p=d(n).attr("id");var s=p+"_easysort_wrapper";var t=p+"_easysort";var o=d("#"+s);if(d(o).length>0){d(o).remove()}o=create_FB_Div().attr("id",s);o.hide();var u=create_FB_UL();u.attr("id",t);u.addClass("easysort");o.append(u);var r=getfieldsJSON();for(var q in r){var v=create_FB_LI();var w=r[q];v.attr("id",w.id).text(w.label).addClass("fb-item-easysort").addClass("fb-round-corners").addClass(w.type);u.append(v)}d(u).sortable({axis:"y",placeholder:"fb-item-easysort-dropzone",forcePlaceholderSize:true,update:function(){updateSort()}});cancelSort=d('<a class="cancelbutton smallerbutton floatleft">cancel</a>');cancelSort.click(function(){SetupScreen("design")});saveSort=d('<a class="savebutton smallerbutton floatleft">save</a>');saveSort.click(function(){SaveNewSortOrder()});u.after(saveSort);u.after(cancelSort);d(n).after(o);SetupScreen("easysort")};SaveNewSortOrder=function(){var q=d(n).attr("id");var v=q+"_easysort";var r=GetSortOrder("#"+v);var u=q+"_easysort_wrapper";var q=d(n).attr("id");var p=q+"_easysort_temp";var t=create_FB_UL();t.attr("id",p);d(t).append(d("#"+q+">li"));d(t).hide();d(n).empty();d(n).after(t);for(var s in r){var w=r[s];var o=GetJQObjectID("P",w.id);d(n).append(d(o))}d("#"+p).remove();SetupScreen("design")};GetSortOrder=function(p){var o={};var s="#"+d(p).attr("id")+">li";var v=d(s).length;for(var q=0;q<v;q++){var u=d(p).children()[q];var r=d(u).attr("id");var t={id:r,pos:q};o[q]=t}return o};SetupScreen_TestDrive=function(){var r=d(n).attr("id");var p=r+"_testdrive_wrapper";var q=r+"_testdrive";var o=d("#"+p);if(d(o).length>0){d(o).remove()}o=create_FB_Div().attr("id",p);o.hide();o.append(d("#"+d(n).attr("id")+">li").clone().removeClass("fb-round-corners").addClass("borderbottom"));cancelTD=d('<a class="cancelbutton smallerbutton floatleft">Finish Testing</a>');cancelTD.click(function(){SetupScreen("design")});o.append(cancelTD);d(n).after(o);d("#"+p+" div.fb-legend").remove();d("#"+p+" div.fb-holder").remove();d("#"+p+" div").removeClass("fb-runtime");d("#"+p+" li").removeClass("fb-item-border");SetupScreen("testdrive")};return this}});